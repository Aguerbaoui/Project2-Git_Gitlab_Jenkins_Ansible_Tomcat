pipeline {
    agent any
   /* environment {
        NEXUS_VERSION = "nexus3"
        NEXUS_PROTOCOL = "http"
        NEXUS_URL = "3.101.63.223:8081"
        NEXUS_REPOSITORY = "javajee"
        NEXUS_CREDENTIAL_ID = "nexus"
    }*/
 stages {
    
    stage('git clone') {
        steps {
        git branch: 'main', credentialsId: 'jenkins', url: 'git@gitlab.com:Aguerbaoui/projet_j2e.git'
        }
    }

    stage('Build') {
        steps {
            withMaven(maven: 'Maven') {
                sh script: 'mvn clean install package'
            }
        }
    }

stage('upload_artifact_to_nexus') {
    steps{
        script{
            def mavenpom = readMavenPom file: 'pom.xml'
          nexusArtifactUploader artifacts: [
            [
                artifactId: 'maven-project',
                classifier: '',
                file: "com/example/maven-project/webapp/1.0-SNAPSHOT/webapp-${mavenpom.version}.war",
                type: 'war'
                ]
            ],
            credentialsId: 'nexus',
            groupId: 'com.example.maven-project',
            nexusUrl: '3.101.63.223:8081',
            nexusVersion: 'nexus3',
            protocol: 'http',
            repository: 'javajee',
            version: "${mavenpom.version}"
        }

    }
}
    stage('Deploy') {
        steps {
            deploy adapters: [tomcat8(credentialsId: 'tomcat', 
            path: '', 
            url: 'http://54.67.30.95:8080/')], 
            contextPath: null, 
            war: '**/*.war'
            }
    }
    } 

      post {
        success {
            emailext body: "${currentBuild.currentResult}: Job ${env.JOB_NAME}\nMore Info can be found here: ${env.BUILD_URL}", recipientProviders: [[$class: 'DevelopersRecipientProvider'], [$class: 'RequesterRecipientProvider']], subject: 'Test'
             
        }
    } 

} 

